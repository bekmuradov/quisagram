(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[8],{"0460":function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-page",{staticClass:"constrain q-pa-md"},[a("div",{staticClass:"row"},[a("div",{staticClass:"col"},[a("div",{staticClass:"camera-frame q-pa-md"},[a("video",{directives:[{name:"show",rawName:"v-show",value:!t.isImageCaptured,expression:"!isImageCaptured"}],ref:"video",staticClass:"full-width",attrs:{autoplay:"",playsinline:""}}),a("canvas",{directives:[{name:"show",rawName:"v-show",value:t.isImageCaptured,expression:"isImageCaptured"}],ref:"canvas",staticClass:"full-width",attrs:{height:"180"}})])]),a("div",{staticClass:"col q-pa-lg"},[a("div",{staticClass:"text-center q-pa-md"},[t.isCameraSupports?a("q-btn",{attrs:{round:"",color:"dark",icon:t.isImageCaptured?"eva-repeat-outline":"eva-camera",size:"md"},on:{click:function(e){t.isImageCaptured?t.reCaptureImage():t.captureImage()}}},[t.isImageCaptured?a("q-tooltip",{attrs:{"content-class":"bg-accent"}},[t._v("Click to recapture the image")]):a("q-tooltip",{attrs:{"content-class":"bg-accent"}},[t._v("Click to capture the image")])],1):a("q-file",{attrs:{accept:"image/*",outlined:"",label:"Pick an image"},on:{input:t.saveImageFromUpload},scopedSlots:t._u([{key:"prepend",fn:function(){return[a("q-icon",{attrs:{name:"eva-attach-outline"}})]},proxy:!0}]),model:{value:t.imageFromUpload,callback:function(e){t.imageFromUpload=e},expression:"imageFromUpload"}})],1),a("div",{staticClass:"row justify-center"},[a("q-input",{staticClass:"col col-sm-8",attrs:{dense:"",label:"Caption *",rules:[function(t){return t.length<=70||"Please use maximum 70 characters"}]},model:{value:t.captionText,callback:function(e){t.captionText=e},expression:"captionText"}})],1),a("div",{staticClass:"row justify-center"},[a("q-input",{staticClass:"col col-sm-8",attrs:{dense:"",label:"Description (optional)"},model:{value:t.descriptionText,callback:function(e){t.descriptionText=e},expression:"descriptionText"}})],1),a("div",{staticClass:"row justify-center"},[a("q-input",{staticClass:"col col-sm-8",attrs:{loading:t.locationLoading,dense:"",label:"Location (optional)"},scopedSlots:t._u([{key:"append",fn:function(){return[!t.locationLoading&&t.isLocationSupported?a("q-btn",{attrs:{round:"",flat:"",dense:"",icon:"eva-navigation-2-outline"},on:{click:t.getLocation}}):t._e()]},proxy:!0}]),model:{value:t.location,callback:function(e){t.location=e},expression:"location"}})],1),a("div",{staticClass:"row justify-center q-mt-md"},[a("q-btn",{staticClass:"col col-sm-8",attrs:{color:"primary",label:"Post Image",rounded:"",unelevated:""},on:{click:function(e){return t.postImage()}}})],1)])])])},i=[],s=(a("c19f"),a("ace4"),a("5cc6"),a("fc1b")),n=a("1732");a("121f");var r={name:"PageUpload",data(){return{expanded:!1,captionText:"",descriptionText:"",location:"",photo:null,isImageCaptured:!1,isCameraSupports:!0,imageFromUpload:[],locationLoading:!1}},computed:{isLocationSupported(){return"geolocation"in navigator}},mounted(){this.initCamera()},beforeDestroy(){this.isCameraSupports&&this.disableCameraOnPageLeave()},methods:{postImage(){const t={contentType:this.photo.type},e={name:Object(n["a"])(),src:this.photo},a={id:Object(n["a"])(),caption:this.captionText,description:this.descriptionText,location:this.location,userId:this.$store.state.pwrup.userProfile.userId,publishedAt:Date.now()/1e3,tags:{},firstComment:{},lastComment:{},comments:[],reactions:{likes:{},likesCount:0}};this.uploadImageToStorage({image:e,meta:t,post:a})},initCamera(){navigator.mediaDevices.getUserMedia({video:!0}).then((t=>{this.$refs.video.srcObject=t})).catch((()=>{this.isCameraSupports=!1}))},captureImage(){let t=this.$refs.video,e=this.$refs.canvas;e.width=t.getBoundingClientRect().width,e.height=t.getBoundingClientRect().height;let a=e.getContext("2d");a.drawImage(t,0,0,e.width,e.height),this.isImageCaptured=!0,this.photo=this.dataURItoBlob(e.toDataURL()),this.disableCameraOnPageLeave()},reCaptureImage(){this.photo="",this.isImageCaptured=!1,this.initCamera()},resetInputs(){this.captionText="",this.descriptionText="",this.location="",this.photo=null,this.isImageCaptured=!1,this.isCameraSupports=!0,this.imageFromUpload=[],this.locationLoading=!1,this.reCaptureImage()},saveImageFromUpload(t){this.photo=t;let e=this.$refs.canvas,a=e.getContext("2d");var o=new FileReader;o.onload=t=>{var o=new Image;o.onload=()=>{e.width=o.width,e.height=o.height,a.drawImage(o,0,0),this.isImageCaptured=!0},o.src=t.target.result},o.readAsDataURL(t)},uploadImageToStorage({image:t,meta:e,post:a}){const o=e.contentType.substring(6),i=s["g"].ref().child("quisagram-images/"+t.name+"."+o),n=i.put(t.src,e);a.imgName="quisagram-images/"+t.name+"."+o;const r=this.$q.notify({group:!1,timeout:0,spinner:!0,message:"Uploading file...",caption:"0%"});n.on("state_changed",(t=>{var e=t.bytesTransferred/t.totalBytes*100;switch(r({caption:`${e}%`}),t.state){case"paused":r({message:"Upload is paused"});break;case"running":r({message:"Upload is running"});break}}),(t=>{switch(t.code){case"storage/unauthorized":r({icon:"error",spinner:!1,message:"You don't have permission to access the object"});break;case"storage/canceled":r({icon:"error",spinner:!1,message:"You canceled the upload"});break;case"storage/unknown":r({icon:"error",spinner:!1,message:"Unknown error occurred, please report us getcyberpresence@gmail.com"});break}}),(()=>{n.snapshot.ref.getDownloadURL().then((t=>{r({icon:"done",spinner:!1,message:"Uploading done!",timeout:2500}),a.imgUrl=t,this.$store.dispatch("pwrup/addPost",{post:a}),this.resetInputs()}))}))},getLocation(){this.locationLoading=!0,navigator.geolocation.getCurrentPosition((t=>{this.getCityAndCountry(t)}),(t=>{this.locationError(t)}),{timeout:7e3})},getCityAndCountry(t){const e=t.coords.latitude,a=t.coords.longitude,o=`https://geocode.xyz/${e},${a}?json=1`;this.$axios.get(o).then((t=>{this.locationSuccess(t.data)})).catch((t=>{this.locationError(t)}))},locationSuccess(t){this.location=t.city,t.country&&(this.location+=`, ${t.country}`),this.locationLoading=!1},locationError(t){this.$q.dialog({title:"Error",message:t.message}),this.locationLoading=!1},disableCameraOnPageLeave(){this.$refs.video.srcObject.getVideoTracks().forEach((t=>{t.stop()}))},dataURItoBlob(t){for(var e=atob(t.split(",")[1]),a=t.split(",")[0].split(":")[1].split(";")[0],o=new ArrayBuffer(e.length),i=new Uint8Array(o),s=0;s<e.length;s++)i[s]=e.charCodeAt(s);var n=new Blob([o],{type:a});return n}}},c=r,l=(a("e121"),a("2877")),p=a("9989"),d=a("9c40"),u=a("05c0"),m=a("7d53"),g=a("0016"),h=a("27f9"),C=a("eebe"),v=a.n(C),f=Object(l["a"])(c,o,i,!1,null,"33e051ba",null);e["default"]=f.exports;v()(f,"components",{QPage:p["a"],QBtn:d["a"],QTooltip:u["a"],QFile:m["a"],QIcon:g["a"],QInput:h["a"]})},"59f1":function(t,e,a){},e121:function(t,e,a){"use strict";a("59f1")}}]);